\include{settings}

\begin{document}	% начало документа
\counterwithin{lstlisting}{section}

% Титульная страница
\include{titlepage}

% Содержание
\include{ToC}

\section{Цель работы}
Целю данного проекта является создание и настройка компьютерной сети для издательской фирмы средствами VMware Workstation. Установка и конфигурация необходимых сервисов. Устанавливаемые сервисы можно разделить на два типа:
\begin{itemize}  
\item Общие сервисы, необходимые для конфигурации сети 
\begin{itemize}
\item DNS сервер - для создания собственной зоны и расширения имен
\item DHCP сервер - для автоматического получения настроек сети
\end{itemize}
\item Специализированные сервисы, необходимые для корректно работы издательской фирмы
\begin{itemize}
\item FTP сервер - для обеспечения возможности удобного обмена информцией между сотрудниками  
\item Mail - создание публичных и доступных аккаунтов для всех сотрудников
\item Jenkins CI - для сборки tex файлов
\end{itemize}
\end{itemize}

\section{Создание и конфигурирование сети}
Топология создаваемой сети приведена на рисунке 1. Данный рисунок, в том числе, показывает, на каких машинах будет установлен тот или иной сервис. Основная сеть разделена на три подсети:
\begin{itemize}
\item VMNet8 - сеть с NAT сервером для выхода в интерент
\item VMNet1 - основная сеть, в которой расположен маршрутизатор, сервера и локальные машины сотрудников
\end{itemize}

\begin{figure}[H]
	\begin{center}
		\includegraphics[width=0.6\linewidth]{pics/topology}
		\caption{Топология сети}
		\label{fig:topology}
	\end{center}
\end{figure}

В зависимости от предназначения машины, выбирается соответствующе ОС:
\begin{itemize}
\item NetBSD - для маршрутизатора
\item Ubuntu Server - для серверов
\item Ubuntu - для локальных машин
\end{itemize}

Приступим к рассмотрению процесса конфигурации

\subsection{Настройка NetBSD}
Для осуществления настройки машины с ОС NetBSD необходимо указать настройки каждого интерфейса в файле /etc/rc.conf, разрешить ip-forwarding в /etc/sysctl.conf и прописать настройки трансляции адресов в /etc/ipnat.rule (рис. 2). 

\begin{figure}[H]
	\begin{center}
		\includegraphics[width=0.6\linewidth]{pics/netBSD}
		\caption{Конфигурация NetBSD}
		\label{fig:NetBsd}
	\end{center}
\end{figure}

\subsection{Настройка Ubuntu Server}
Все сервера должны иметь статические IP-адреса. Для их настройки необходимо отредактировать файл /etc/network/interfaces. Для статического IP указываем слежующие настройки. Указанные настройки идентичны для каждого сервера. Различаются только адреса. 
\lstinputlisting{listings/ubuntuServer}

\subsection{Настройка клиентской Ubuntu}
Для корректного получения настроек по сети, на пользовательской машине достаточно будет настроить работу с DHCP.
\lstinputlisting{listings/ubuntu}

\section{Установка и настройка сетевых сервисов}
\subsection{Настройка DHCP}
Настройку DHCP сервера производим на маршрутизаторе с ОС NetBSD. Настройки DHCP сервера находятся в фалйе /etc/dhcpd.conf. В том случае, если данного файла нет в системе, его необходимо создать. В конфигурационном файле указывается доменное имя сети, адрес DNS, и настройки для сети.\\
Если все настройки заданы верно, то при включении DHCP на клиентской машине, будут выданы IP-адрес из указанного диапазона, шлюз по умолчанию и адрес DNS сервера.

\subsection{Настройка DNS}
Настройка DNS производится на сервере с ОС Ubuntu Server и IP-адресом: 192.168.10.7. Для выполнения этой задачи необходимо установить DNS сервер BIND9. Данный сервер доступен из репозитриев Ubuntu. Следовательно, для его установки будет достаточно команды:\textit{sudo apt install bind9}.
После установки, приступаем непосредственно к конфигурации сервера. Основные его настройки находятся в файле \textit{/etc/named.conf}:
\lstinputlisting{listings/bind9}

Единственное изменение, внесенное в данный файл - объявление своей зоны \textit{example.com}. В этом файле мы указали, что данный сервер будет мастер-сервером для этой зоны и указали путь к файлу с описанием этой зоны. Ниже покажем содержание данного файла:
\lstinputlisting{listings/dns}

В данном файле, помимо стандартных записей были указаны:
\begin{itemize}
	\item ftp.example.com - ftp сервер (192.168.10.8)
	\item mail.example.com - почтовый сервер (192.168.10.7)
	\item ci.example.com - jenkins (192.168.10.8)
\end{itemize}
Следующий этап - перезагрузка сервера DNS и добавление его в автозапуск.
\begin{lstlisting}
sudo systemctl restart named
sudo systemctl enable named
\end{lstlisting}
С клиентской машины была произведена проверка работы DNS сервера (рис. ).

\subsection{Настройка FTP}
Настройка FTP сервера необходима для возможности удобного обмена данными между сотрудниками издательской фирмы. У всех сотрудников должны быть одинаковые права доступа к информации. Одним из главных критериев организации сети в издательской фирме является безопасность. Исходя из этого критерия были осуществленны следующие настройки сервера:
\begin{itemize}
	\item Ограничение свободного доступа к серверу
	\item Обеспечение возможности записи на сервер для пользователей, вошедших на сервер
	\item Настройка SSL подключения
\end{itemize}
Настройки сервера производятся в файле \textit{/etc/vsftpd/vsftpd.conf}:
\lstinputlisting{listings/ftp}
После настройки - перезапускаем сервер и добавляем его в автозагрузку:
\begin{lstlisting}
sudo systemctl restart vsftpd
sudo systemctl enable vsftpd
\end{lstlisting}

\subsection{Настройка почтового сервера}
Установка почтового сервера произведена на машине с IP-адресом 192.168.10.7. Для достижения заданной цели был использован популярный почтовый сервер iRedMail. Данное решение представляет из себя бесплатный проект с открытым исходным кодом для различных Linux дистрибутивов. iRedMail является защищенным решением, хранение паролей производится в хэшированном виде и доступ к почтовым сервисам осуществляется через защищенное соединение.\\
Установку iRedMail можно выполнить двумя способами:
\begin{itemize}
	\item Из исходных файлов, которые находятся на \textit{bitbucket}
	\item Cкачать стабильную версию с сайта
\end{itemize}
В данной работе был использован первый способ:
\begin{lstlisting}
cd /root
wget https://bitbucket.org/zhb/iredmail/downloads/iRedMail-0.9.5-1.tar.bz2
tar -xjf iRedMail-0.9.5-1.tar.bz2
cd iRedMail-0.9.5-1
sh iRedMail.sh
\end{lstlisting}
После выполнения данных строк, запустится скрипт установки iRedMail. Во время установки необходимо будет ввести требуемые параметры, такие как используемая база данных (OpenLDAP, MySQL, PostgreSQL), аккаунт администратора, почтовый домен и т.д.\\
Когда установка завершена, в браузере можно зайти на веб-страницу администратора почты по адресу \textit{https://mail.example.com/iredadmin}.\\
Для удобного доступа сотрудников к своей почте, настроим почтовый клиент Mozilla Thunderbird и попробуем отправить с него почту на почтовый адрес в yandex.
\begin{figure}[H]
	\begin{center}
		\includegraphics[width=0.6\linewidth]{pics/mail}
		\caption{Проверка работы почтового сервера}
		\label{fig:mail}
	\end{center}
\end{figure}

\subsection{Настройка Jenkins CI}
Полезным сервисом для издательской фирмы будет непрерывная сборка tex файлов. Для настройки такого сервиса был использован Jenkins. Данное решение является бесплатным с открытым исходным кодом и может использоваться для автоматизации различных задач, таких как: сборка, тестирование и развертывание программного обеспечения.
\\Установка Jenkins была произведена на той же машине, что и FTP сервер. На ОС Ubuntu Server необходимо выполнить следующие команды:
\begin{lstlisting}
wget -q -O - https://pkg.jenkins.io/debian/jenkins-ci.org.key | sudo apt-key add -
sudo sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'
sudo apt update
sudo apt install jenkins
\end{lstlisting}
Данные команды устанавливают Jenkins и, в последующем, он будет запускаться в виде демона на старте системы. По умолчанию Jenkins запускается по адресу \textit{http://localhost:8080/}. Для того, чтобы можно было получить доступ к Jenkins по адресу \textit{ci.example.com}, необходимо настроить nginx. Сначала необходимо его установить и удалить стандартные настройки:
\begin{lstlisting}
sudo aptitude -y install nginx
cd /etc/nginx/sites-available
sudo rm default ../sites-enabled/default
\end{lstlisting}

Создаем свои настройки и указываем ci.example.com.
\lstinputlisting{listings/nginx}

Вся последующая конфигурация работы Jenkins производится с помощью вебинтерфейса. Пример конфигурации, завязанной на git, приведен ниже:
\begin{figure}[H]
	\begin{center}
		\includegraphics[width=0.6\linewidth]{pics/jenkins}
		\caption{Пример настройки Jenkins}
		\label{fig:jenkins}
	\end{center}
\end{figure}


\section*{Заключение}
\addcontentsline{toc}{section}{Заключение}
В результате выполнения работы была создана и настроена виртуальная локальная сеть издательского агенства. Работа была выполнена средствами VMwar Workstation. \\
В ходе работы были установлены и сконфигурированы различные сервисы такие, как обычные сервисы, необходимые для корректной работы сети, так и специализированные. 
Для настройки DNS сервера был использован BIND9. Была создана своя зона \textit{example.com} и база соответствия доменных имен IP-адресам. \\
Для снастройки FTP сервера был использован vsftpd. Данный сервер был сконфигурирован согласно требованиям, предъявляемым организации сети в издательской фирме. \\
Создание почтового сервера основывается на установке и настройке iRedMail. С установленного сервера получилось отправить сообщение на существующий почтовый ящик. \\
Последний сервис, который был настроен - Jenkins. Данный сервис позволяет организовать сборку файлов Tex. Он очень прост в настройке, так как вся настройка производится через веб-интерфейс.

\end{document}
